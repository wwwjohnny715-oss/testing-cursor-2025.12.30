(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,89271,e=>{"use strict";e.s(["GRADE_OPTIONS",0,["S1","S2","S3","S4","S5","S6","retaker","P1","P2","P3","P4","P5","P6"],"SUBJECT_OPTIONS",0,["中文","英文","數學","物理","化學","生物","M1","M2","經濟","會計","歷史","中史","地理","其他"]])},15288,e=>{"use strict";var t=e.i(43476),a=e.i(75157);function s({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function r({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function l({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...s})}function n({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...s})}function c({className:e,...s}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...s})}e.s(["Card",()=>s,"CardContent",()=>c,"CardDescription",()=>n,"CardHeader",()=>r,"CardTitle",()=>l])},94508,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(48148),r=e.i(15288),l=e.i(67489),n=e.i(84774),c=e.i(19455);let i=(0,e.i(75254).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var o=e.i(46696),d=e.i(89271);function h({teachers:e,sessions:h,isAdmin:u}){let m=(0,s.useTranslations)(),x=new Date,[j,b]=(0,a.useState)("teacher-month"),[g,C]=(0,a.useState)(`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}`),[S,p]=(0,a.useState)(""),[f,T]=(0,a.useState)(!1),v=(0,a.useMemo)(()=>{let e=[];for(let t=0;t<12;t++){let a=new Date(x.getFullYear(),x.getMonth()-t,1),s=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`,r=`${a.getFullYear()}年${a.getMonth()+1}月`;e.push({value:s,label:r})}return e},[x]),w=(0,a.useMemo)(()=>{let[e,t]=g.split("-").map(Number),a=new Date(e,t-1,1),s=new Date(e,t,0,23,59,59,999);if("teacher-month"===j||"teacher-total"===j){let e="teacher-month"===j,t={};for(let r of h){let l=new Date(r.date);if(e&&(l<a||l>s))continue;let n=r.course.teacher_id;t[n]||(t[n]={teacherCode:r.course.teacher.teacherCode,name:r.course.teacher.name,minutes:0}),t[n].minutes+=r.duration_minutes}return Object.entries(t).map(([e,t])=>({id:e,...t})).sort((e,t)=>t.minutes-e.minutes)}{let e="subject-month"===j,t={};for(let r of h){let l=new Date(r.date);if(e&&(l<a||l>s))continue;let n=r.course.teacher.subjects;for(let e of n)t[e]||(t[e]=0),t[e]+=r.duration_minutes/n.length}return d.SUBJECT_OPTIONS.filter(e=>t[e]).map(e=>({subject:e,minutes:Math.round(t[e]||0)})).sort((e,t)=>t.minutes-e.minutes)}},[h,j,g]),N=async()=>{if(!S)return void o.toast.error(m("common.fillRequired"));T(!0);try{let e=await fetch(`/api/export/hours?teacherId=${S}&month=${g}`);if(!e.ok)throw Error(m("common.operationFailed"));let t=await e.blob(),a=window.URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=`hours_${S}_${g}.xlsx`,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(a),document.body.removeChild(s),o.toast.success(m("common.success"))}catch(e){o.toast.error(e instanceof Error?e.message:m("common.operationFailed"))}finally{T(!1)}},y=j.startsWith("teacher");return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(r.Card,{children:[(0,t.jsxs)(r.CardHeader,{children:[(0,t.jsx)(r.CardTitle,{children:m("stats.hours")}),(0,t.jsx)(r.CardDescription,{children:m("stats.totalHours")})]}),(0,t.jsx)(r.CardContent,{children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,t.jsx)("div",{className:"w-48",children:(0,t.jsxs)(l.Select,{value:j,onValueChange:e=>b(e),children:[(0,t.jsx)(l.SelectTrigger,{children:(0,t.jsx)(l.SelectValue,{})}),(0,t.jsxs)(l.SelectContent,{children:[(0,t.jsx)(l.SelectItem,{value:"teacher-month",children:m("stats.byTeacherMonthly")}),(0,t.jsx)(l.SelectItem,{value:"teacher-total",children:m("stats.byTeacherCumulative")}),(0,t.jsx)(l.SelectItem,{value:"subject-month",children:m("stats.bySubjectMonthly")}),(0,t.jsx)(l.SelectItem,{value:"subject-total",children:m("stats.bySubjectCumulative")})]})]})}),("teacher-month"===j||"subject-month"===j)&&(0,t.jsx)("div",{className:"w-40",children:(0,t.jsxs)(l.Select,{value:g,onValueChange:C,children:[(0,t.jsx)(l.SelectTrigger,{children:(0,t.jsx)(l.SelectValue,{})}),(0,t.jsx)(l.SelectContent,{children:v.map(e=>(0,t.jsx)(l.SelectItem,{value:e.value,children:e.label},e.value))})]})}),u&&y&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"w-48",children:(0,t.jsxs)(l.Select,{value:S,onValueChange:p,children:[(0,t.jsx)(l.SelectTrigger,{children:(0,t.jsx)(l.SelectValue,{placeholder:m("courses.selectTeacher")})}),(0,t.jsx)(l.SelectContent,{children:e.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id,children:e.name},e.id))})]})}),(0,t.jsxs)(c.Button,{variant:"outline",onClick:N,disabled:!S||f,children:[(0,t.jsx)(i,{className:"h-4 w-4 mr-2"}),m("stats.exportExcel")]})]})]})})]}),(0,t.jsx)(r.Card,{children:(0,t.jsx)(r.CardContent,{className:"pt-6",children:(0,t.jsxs)(n.Table,{children:[(0,t.jsx)(n.TableHeader,{children:(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableHead,{children:y?m("auth.teacher"):m("teachers.subjects")}),y&&(0,t.jsx)(n.TableHead,{children:m("teachers.teacherCode")}),(0,t.jsx)(n.TableHead,{className:"text-right",children:m("stats.totalMinutes")}),(0,t.jsx)(n.TableHead,{className:"text-right",children:m("stats.totalHours")})]})}),(0,t.jsx)(n.TableBody,{children:0===w.length?(0,t.jsx)(n.TableRow,{children:(0,t.jsx)(n.TableCell,{colSpan:y?4:3,className:"h-24 text-center text-muted-foreground",children:m("stats.noData")})}):y?w.map(e=>(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableCell,{className:"font-medium",children:e.name}),(0,t.jsx)(n.TableCell,{className:"font-mono",children:e.teacherCode}),(0,t.jsx)(n.TableCell,{className:"text-right",children:e.minutes}),(0,t.jsx)(n.TableCell,{className:"text-right",children:(e.minutes/60).toFixed(1)})]},e.id)):w.map(e=>(0,t.jsxs)(n.TableRow,{children:[(0,t.jsx)(n.TableCell,{className:"font-medium",children:e.subject}),(0,t.jsx)(n.TableCell,{className:"text-right",children:e.minutes}),(0,t.jsx)(n.TableCell,{className:"text-right",children:(e.minutes/60).toFixed(1)})]},e.subject))})]})})})]})}e.s(["HoursStats",()=>h],94508)}]);