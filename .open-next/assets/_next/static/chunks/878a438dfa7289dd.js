(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15288,e=>{"use strict";var t=e.i(43476),r=e.i(75157);function a({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...a})}function s({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...a})}function n({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",e),...a})}function l({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",e),...a})}function d({className:e,...a}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",e),...a})}e.s(["Card",()=>a,"CardContent",()=>d,"CardDescription",()=>l,"CardHeader",()=>s,"CardTitle",()=>n])},89271,e=>{"use strict";e.s(["GRADE_OPTIONS",0,["S1","S2","S3","S4","S5","S6","retaker","P1","P2","P3","P4","P5","P6"],"SUBJECT_OPTIONS",0,["中文","英文","數學","物理","化學","生物","M1","M2","經濟","會計","歷史","中史","地理","其他"]])},87486,e=>{"use strict";var t=e.i(43476),r=e.i(91918),a=e.i(25913),s=e.i(75157);let n=(0,a.cva)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:a,asChild:l=!1,...d}){let o=l?r.Slot:"span";return(0,t.jsx)(o,{"data-slot":"badge",className:(0,s.cn)(n({variant:a}),e),...d})}e.s(["Badge",()=>l])},69872,e=>{"use strict";var t=e.i(43476),r=e.i(71645),a=e.i(48148),s=e.i(15288),n=e.i(67489),l=e.i(84774),d=e.i(87486),o=e.i(89271);function i({courses:e}){let i=(0,a.useTranslations)(),c=new Date,[u,h]=(0,r.useState)("teacher"),[x,g]=(0,r.useState)(`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`),b=(0,r.useMemo)(()=>{let e=[];for(let t=0;t<12;t++){let r=new Date(c.getFullYear(),c.getMonth()-t,1),a=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`,s=`${r.getFullYear()}年${r.getMonth()+1}月`;e.push({value:a,label:s})}return e},[c]),m=(0,r.useMemo)(()=>{let[t,r]=x.split("-").map(Number),a=new Date(t,r-1,1),s=new Date(t,r,0,23,59,59,999),n=new Date(t,r-2,1),l=new Date(t,r-1,0,23,59,59,999),d=(t,r)=>e.filter(e=>e.sessions.some(e=>{let a=new Date(e.date);return a>=t&&a<=r})),i=d(a,s),c=d(n,l);if("teacher"===u){let e={};for(let t of c){let r=t.teacher.id;for(let a of(e[r]||(e[r]={teacherCode:t.teacher.teacherCode,name:t.teacher.name,lastMonthStudents:new Set,currentMonthOldStudents:new Set}),t.enrollments))e[r].lastMonthStudents.add(a.student.studentCode)}for(let t of i){let r=t.teacher.id;if(e[r])for(let a of t.enrollments){let t=a.student.studentCode,s=a.student.first_enrolled_at;s&&new Date(s)<=l&&e[r].lastMonthStudents.has(t)&&e[r].currentMonthOldStudents.add(t)}}return Object.entries(e).map(([e,t])=>{let r=t.lastMonthStudents.size,a=t.currentMonthOldStudents.size;return{id:e,teacherCode:t.teacherCode,name:t.name,lastMonthCount:r,currentOldCount:a,rate:r>0?a/r*100:0}}).filter(e=>e.lastMonthCount>0).sort((e,t)=>t.rate-e.rate)}{let e={};for(let t of c)for(let r of t.teacher.subjects)for(let a of(e[r]||(e[r]={lastMonthStudents:new Set,currentMonthOldStudents:new Set}),t.enrollments))e[r].lastMonthStudents.add(a.student.studentCode);for(let t of i)for(let r of t.teacher.subjects)if(e[r])for(let a of t.enrollments){let t=a.student.studentCode,s=a.student.first_enrolled_at;s&&new Date(s)<=l&&e[r].lastMonthStudents.has(t)&&e[r].currentMonthOldStudents.add(t)}return o.SUBJECT_OPTIONS.filter(t=>e[t]&&e[t].lastMonthStudents.size>0).map(t=>{let r=e[t],a=r.lastMonthStudents.size,s=r.currentMonthOldStudents.size;return{subject:t,lastMonthCount:a,currentOldCount:s,rate:a>0?s/a*100:0}}).sort((e,t)=>t.rate-e.rate)}},[e,u,x]),f="teacher"===u;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(s.Card,{children:[(0,t.jsxs)(s.CardHeader,{children:[(0,t.jsx)(s.CardTitle,{children:i("stats.retention")}),(0,t.jsx)(s.CardDescription,{children:i("stats.retentionRate")})]}),(0,t.jsx)(s.CardContent,{children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,t.jsx)("div",{className:"w-48",children:(0,t.jsxs)(n.Select,{value:u,onValueChange:e=>h(e),children:[(0,t.jsx)(n.SelectTrigger,{children:(0,t.jsx)(n.SelectValue,{})}),(0,t.jsxs)(n.SelectContent,{children:[(0,t.jsx)(n.SelectItem,{value:"teacher",children:i("stats.byTeacher")}),(0,t.jsx)(n.SelectItem,{value:"subject",children:i("stats.bySubject")})]})]})}),(0,t.jsx)("div",{className:"w-40",children:(0,t.jsxs)(n.Select,{value:x,onValueChange:g,children:[(0,t.jsx)(n.SelectTrigger,{children:(0,t.jsx)(n.SelectValue,{})}),(0,t.jsx)(n.SelectContent,{children:b.map(e=>(0,t.jsx)(n.SelectItem,{value:e.value,children:e.label},e.value))})]})})]})})]}),(0,t.jsx)(s.Card,{children:(0,t.jsx)(s.CardContent,{className:"pt-6",children:(0,t.jsxs)(l.Table,{children:[(0,t.jsx)(l.TableHeader,{children:(0,t.jsxs)(l.TableRow,{children:[(0,t.jsx)(l.TableHead,{children:i(f?"auth.teacher":"teachers.subjects")}),f&&(0,t.jsx)(l.TableHead,{children:i("teachers.teacherCode")}),(0,t.jsx)(l.TableHead,{className:"text-right",children:i("stats.totalStudents")}),(0,t.jsx)(l.TableHead,{className:"text-right",children:i("stats.monthly")}),(0,t.jsx)(l.TableHead,{className:"text-right",children:i("stats.retentionRate")})]})}),(0,t.jsx)(l.TableBody,{children:0===m.length?(0,t.jsx)(l.TableRow,{children:(0,t.jsx)(l.TableCell,{colSpan:f?5:4,className:"h-24 text-center text-muted-foreground",children:i("stats.noData")})}):f?m.map(e=>(0,t.jsxs)(l.TableRow,{children:[(0,t.jsx)(l.TableCell,{className:"font-medium",children:e.name}),(0,t.jsx)(l.TableCell,{className:"font-mono",children:e.teacherCode}),(0,t.jsx)(l.TableCell,{className:"text-right",children:e.lastMonthCount}),(0,t.jsx)(l.TableCell,{className:"text-right",children:e.currentOldCount}),(0,t.jsx)(l.TableCell,{className:"text-right",children:(0,t.jsxs)(d.Badge,{className:e.rate>=80?"bg-green-500/20 text-green-400 border-green-500/30":e.rate>=50?"bg-yellow-500/20 text-yellow-400 border-yellow-500/30":"bg-red-500/20 text-red-400 border-red-500/30",children:[e.rate.toFixed(1),"%"]})})]},e.id)):m.map(e=>(0,t.jsxs)(l.TableRow,{children:[(0,t.jsx)(l.TableCell,{className:"font-medium",children:e.subject}),(0,t.jsx)(l.TableCell,{className:"text-right",children:e.lastMonthCount}),(0,t.jsx)(l.TableCell,{className:"text-right",children:e.currentOldCount}),(0,t.jsx)(l.TableCell,{className:"text-right",children:(0,t.jsxs)(d.Badge,{className:e.rate>=80?"bg-green-500/20 text-green-400 border-green-500/30":e.rate>=50?"bg-yellow-500/20 text-yellow-400 border-yellow-500/30":"bg-red-500/20 text-red-400 border-red-500/30",children:[e.rate.toFixed(1),"%"]})})]},e.subject))})]})})})]})}e.s(["RetentionStats",()=>i])}]);