module.exports=[35785,a=>{"use strict";a.s(["GRADE_OPTIONS",0,["S1","S2","S3","S4","S5","S6","retaker","P1","P2","P3","P4","P5","P6"],"SUBJECT_OPTIONS",0,["中文","英文","數學","物理","化學","生物","M1","M2","經濟","會計","歷史","中史","地理","其他"]])},91119,a=>{"use strict";var b=a.i(87924),c=a.i(68114);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-description",className:(0,c.cn)("text-muted-foreground text-sm",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>h,"CardDescription",()=>g,"CardHeader",()=>e,"CardTitle",()=>f])},25298,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(15925),e=a.i(91119),f=a.i(80701),g=a.i(6015),h=a.i(99570);let i=(0,a.i(70106).default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var j=a.i(23292),k=a.i(35785);function l({teachers:a,sessions:l,isAdmin:m}){let n=(0,d.useTranslations)(),o=new Date,[p,q]=(0,c.useState)("teacher-month"),[r,s]=(0,c.useState)(`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}`),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(!1),x=(0,c.useMemo)(()=>{let a=[];for(let b=0;b<12;b++){let c=new Date(o.getFullYear(),o.getMonth()-b,1),d=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,e=`${c.getFullYear()}年${c.getMonth()+1}月`;a.push({value:d,label:e})}return a},[o]),y=(0,c.useMemo)(()=>{let[a,b]=r.split("-").map(Number),c=new Date(a,b-1,1),d=new Date(a,b,0,23,59,59,999);if("teacher-month"===p||"teacher-total"===p){let a="teacher-month"===p,b={};for(let e of l){let f=new Date(e.date);if(a&&(f<c||f>d))continue;let g=e.course.teacher_id;b[g]||(b[g]={teacherCode:e.course.teacher.teacherCode,name:e.course.teacher.name,minutes:0}),b[g].minutes+=e.duration_minutes}return Object.entries(b).map(([a,b])=>({id:a,...b})).sort((a,b)=>b.minutes-a.minutes)}{let a="subject-month"===p,b={};for(let e of l){let f=new Date(e.date);if(a&&(f<c||f>d))continue;let g=e.course.teacher.subjects;for(let a of g)b[a]||(b[a]=0),b[a]+=e.duration_minutes/g.length}return k.SUBJECT_OPTIONS.filter(a=>b[a]).map(a=>({subject:a,minutes:Math.round(b[a]||0)})).sort((a,b)=>b.minutes-a.minutes)}},[l,p,r]),z=async()=>{if(!t)return void j.toast.error(n("common.fillRequired"));w(!0);try{let a=await fetch(`/api/export/hours?teacherId=${t}&month=${r}`);if(!a.ok)throw Error(n("common.operationFailed"));let b=await a.blob(),c=window.URL.createObjectURL(b),d=document.createElement("a");d.href=c,d.download=`hours_${t}_${r}.xlsx`,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(c),document.body.removeChild(d),j.toast.success(n("common.success"))}catch(a){j.toast.error(a instanceof Error?a.message:n("common.operationFailed"))}finally{w(!1)}},A=p.startsWith("teacher");return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{children:n("stats.hours")}),(0,b.jsx)(e.CardDescription,{children:n("stats.totalHours")})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,b.jsx)("div",{className:"w-48",children:(0,b.jsxs)(f.Select,{value:p,onValueChange:a=>q(a),children:[(0,b.jsx)(f.SelectTrigger,{children:(0,b.jsx)(f.SelectValue,{})}),(0,b.jsxs)(f.SelectContent,{children:[(0,b.jsx)(f.SelectItem,{value:"teacher-month",children:n("stats.byTeacherMonthly")}),(0,b.jsx)(f.SelectItem,{value:"teacher-total",children:n("stats.byTeacherCumulative")}),(0,b.jsx)(f.SelectItem,{value:"subject-month",children:n("stats.bySubjectMonthly")}),(0,b.jsx)(f.SelectItem,{value:"subject-total",children:n("stats.bySubjectCumulative")})]})]})}),("teacher-month"===p||"subject-month"===p)&&(0,b.jsx)("div",{className:"w-40",children:(0,b.jsxs)(f.Select,{value:r,onValueChange:s,children:[(0,b.jsx)(f.SelectTrigger,{children:(0,b.jsx)(f.SelectValue,{})}),(0,b.jsx)(f.SelectContent,{children:x.map(a=>(0,b.jsx)(f.SelectItem,{value:a.value,children:a.label},a.value))})]})}),m&&A&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"w-48",children:(0,b.jsxs)(f.Select,{value:t,onValueChange:u,children:[(0,b.jsx)(f.SelectTrigger,{children:(0,b.jsx)(f.SelectValue,{placeholder:n("courses.selectTeacher")})}),(0,b.jsx)(f.SelectContent,{children:a.map(a=>(0,b.jsx)(f.SelectItem,{value:a.id,children:a.name},a.id))})]})}),(0,b.jsxs)(h.Button,{variant:"outline",onClick:z,disabled:!t||v,children:[(0,b.jsx)(i,{className:"h-4 w-4 mr-2"}),n("stats.exportExcel")]})]})]})})]}),(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardContent,{className:"pt-6",children:(0,b.jsxs)(g.Table,{children:[(0,b.jsx)(g.TableHeader,{children:(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableHead,{children:A?n("auth.teacher"):n("teachers.subjects")}),A&&(0,b.jsx)(g.TableHead,{children:n("teachers.teacherCode")}),(0,b.jsx)(g.TableHead,{className:"text-right",children:n("stats.totalMinutes")}),(0,b.jsx)(g.TableHead,{className:"text-right",children:n("stats.totalHours")})]})}),(0,b.jsx)(g.TableBody,{children:0===y.length?(0,b.jsx)(g.TableRow,{children:(0,b.jsx)(g.TableCell,{colSpan:A?4:3,className:"h-24 text-center text-muted-foreground",children:n("stats.noData")})}):A?y.map(a=>(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(g.TableCell,{className:"font-mono",children:a.teacherCode}),(0,b.jsx)(g.TableCell,{className:"text-right",children:a.minutes}),(0,b.jsx)(g.TableCell,{className:"text-right",children:(a.minutes/60).toFixed(1)})]},a.id)):y.map(a=>(0,b.jsxs)(g.TableRow,{children:[(0,b.jsx)(g.TableCell,{className:"font-medium",children:a.subject}),(0,b.jsx)(g.TableCell,{className:"text-right",children:a.minutes}),(0,b.jsx)(g.TableCell,{className:"text-right",children:(a.minutes/60).toFixed(1)})]},a.subject))})]})})})]})}a.s(["HoursStats",()=>l],25298)}];

//# sourceMappingURL=src_5e50233e._.js.map