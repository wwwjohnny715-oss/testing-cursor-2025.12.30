module.exports=[21188,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(15925),f=a.i(99570),g=a.i(66718),h=a.i(86304),i=a.i(15055),j=a.i(6015),k=a.i(14574),l=a.i(80701),m=a.i(70430),n=a.i(15618),o=a.i(87532),p=a.i(99464),q=a.i(81560),r=a.i(96221),s=a.i(23292),t=a.i(35785),u=a.i(56711);function v({students:a,isAdmin:v,initialSearch:w="",initialNewOnly:x}){let y=(0,d.useRouter)(),z=(0,e.useTranslations)(),[A,B]=(0,c.useState)(w),[C,D]=(0,c.useState)(x),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)("soft"),[M,N]=(0,c.useState)(null),[O,P]=(0,c.useState)(!1),[Q,R]=(0,c.useState)({studentCode:"",name:"",phone:"",grade:""}),S=()=>{let a=new URLSearchParams;A&&a.set("search",A),C&&a.set("newOnly","true"),y.push(`/students?${a.toString()}`)},T=()=>{R({studentCode:"",name:"",phone:"",grade:""})},U=async()=>{if(!Q.name||!Q.phone||!Q.grade||!Q.studentCode)return void s.toast.error(z("common.fillRequired"));P(!0);try{let a=await fetch("/api/students",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)});if(!a.ok){let b=await a.json();throw Error(b.error||z("common.operationFailed"))}s.toast.success(z("students.createSuccess")),F(!1),T(),y.refresh()}catch(a){s.toast.error(a instanceof Error?a.message:z("common.operationFailed"))}finally{P(!1)}},V=async()=>{if(M){if(!Q.name||!Q.phone||!Q.grade)return void s.toast.error(z("common.fillRequired"));P(!0);try{let a=await fetch(`/api/students/${M.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:Q.name,phone:Q.phone,grade:Q.grade})});if(!a.ok){let b=await a.json();throw Error(b.error||z("common.operationFailed"))}s.toast.success(z("students.updateSuccess")),H(!1),N(null),T(),y.refresh()}catch(a){s.toast.error(a instanceof Error?a.message:z("common.operationFailed"))}finally{P(!1)}}},W=async a=>{if(M){P(!0);try{let b="hard"===a?`/api/students/${M.id}?hard=true`:`/api/students/${M.id}`,c=await fetch(b,{method:"DELETE"});if(!c.ok){let a=await c.json();throw Error(a.error||z("common.deleteFailed"))}s.toast.success(z("students.deleteSuccess")),J(!1),N(null),L("soft"),y.refresh()}catch(a){s.toast.error(a instanceof Error?a.message:z("common.deleteFailed"))}finally{P(!1)}}};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-between",children:[(0,b.jsxs)("div",{className:"flex flex-1 gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:z("students.searchPlaceholder"),value:A,onChange:a=>B(a.target.value),onKeyDown:a=>{"Enter"===a.key&&S()},className:"pl-9"})]}),(0,b.jsx)(f.Button,{variant:"secondary",onClick:S,children:z("common.search")})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.Checkbox,{id:"newOnly",checked:C,onCheckedChange:a=>{D(a);let b=new URLSearchParams;A&&b.set("search",A),a&&b.set("newOnly","true"),y.push(`/students?${b.toString()}`)}}),(0,b.jsx)(m.Label,{htmlFor:"newOnly",className:"text-sm cursor-pointer",children:z("students.filterNewStudents")})]}),v&&(0,b.jsxs)(f.Button,{onClick:()=>F(!0),children:[(0,b.jsx)(n.Plus,{className:"h-4 w-4 mr-2"}),z("students.addStudent")]})]})]}),(0,b.jsx)("div",{className:"rounded-lg border border-border bg-card",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:z("students.studentCode")}),(0,b.jsx)(j.TableHead,{children:z("students.name")}),(0,b.jsx)(j.TableHead,{children:z("students.phone")}),(0,b.jsx)(j.TableHead,{children:z("students.grade")}),(0,b.jsx)(j.TableHead,{children:z("common.status")}),(0,b.jsx)(j.TableHead,{children:z("students.enrolledCourses")}),(0,b.jsx)(j.TableHead,{children:z("students.createdAt")}),v&&(0,b.jsx)(j.TableHead,{className:"text-right",children:z("common.actions")})]})}),(0,b.jsx)(j.TableBody,{children:0===a.length?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:v?8:7,className:"h-24 text-center text-muted-foreground",children:z("students.noStudents")})}):a.map(a=>(0,b.jsxs)(j.TableRow,{className:"group",children:[(0,b.jsx)(j.TableCell,{className:"font-mono",children:a.studentCode}),(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(j.TableCell,{children:a.phone}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(h.Badge,{variant:"outline",children:a.grade})}),(0,b.jsx)(j.TableCell,{children:a.isNew?(0,b.jsx)(h.Badge,{className:"bg-primary/20 text-primary border-primary/30",children:z("students.isNew")}):a.first_enrolled_at?(0,b.jsx)(h.Badge,{variant:"secondary",children:"-"}):(0,b.jsx)(h.Badge,{variant:"outline",className:"text-muted-foreground",children:"-"})}),(0,b.jsx)(j.TableCell,{children:a.activeCourses.length>0?(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.activeCourses.slice(0,2).map(a=>(0,b.jsx)(h.Badge,{variant:"outline",className:"text-xs",children:a},a)),a.activeCourses.length>2&&(0,b.jsxs)(h.Badge,{variant:"outline",className:"text-xs",children:["+",a.activeCourses.length-2]})]}):(0,b.jsx)("span",{className:"text-muted-foreground text-sm",children:"-"})}),(0,b.jsx)(j.TableCell,{className:"text-muted-foreground",children:(0,u.format)(new Date(a.created_at),"yyyy/MM/dd")}),v&&(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>{N(a),R({studentCode:a.studentCode,name:a.name,phone:a.phone,grade:a.grade}),H(!0)},children:(0,b.jsx)(p.Pencil,{className:"h-4 w-4"})}),(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",onClick:()=>{N(a),L("soft"),J(!0)},children:(0,b.jsx)(q.Trash2,{className:"h-4 w-4 text-destructive"})})]})})]},a.id))})]})}),(0,b.jsx)(k.Dialog,{open:E,onOpenChange:F,children:(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:z("students.addStudent")}),(0,b.jsx)(k.DialogDescription,{children:z("students.fillInfo")})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)(m.Label,{htmlFor:"studentCode",children:[z("students.studentCode")," *"]}),(0,b.jsx)(g.Input,{id:"studentCode",placeholder:"S006",value:Q.studentCode,onChange:a=>R({...Q,studentCode:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)(m.Label,{htmlFor:"name",children:[z("students.name")," *"]}),(0,b.jsx)(g.Input,{id:"name",placeholder:z("students.namePlaceholder"),value:Q.name,onChange:a=>R({...Q,name:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)(m.Label,{htmlFor:"phone",children:[z("students.phone")," *"]}),(0,b.jsx)(g.Input,{id:"phone",placeholder:"98765432",value:Q.phone,onChange:a=>R({...Q,phone:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)(m.Label,{htmlFor:"grade",children:[z("students.grade")," *"]}),(0,b.jsxs)(l.Select,{value:Q.grade,onValueChange:a=>R({...Q,grade:a}),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:z("students.grade")})}),(0,b.jsx)(l.SelectContent,{children:t.GRADE_OPTIONS.map(a=>(0,b.jsx)(l.SelectItem,{value:a,children:a},a))})]})]})]}),(0,b.jsxs)(k.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{F(!1),T()},children:z("common.cancel")}),(0,b.jsxs)(f.Button,{onClick:U,disabled:O,children:[O&&(0,b.jsx)(r.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),z("common.add")]})]})]})}),(0,b.jsx)(k.Dialog,{open:G,onOpenChange:H,children:(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:z("students.editStudent")}),(0,b.jsxs)(k.DialogDescription,{children:[z("students.studentCode"),": ",M?.studentCode]})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)(m.Label,{htmlFor:"edit-name",children:[z("students.name")," *"]}),(0,b.jsx)(g.Input,{id:"edit-name",value:Q.name,onChange:a=>R({...Q,name:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)(m.Label,{htmlFor:"edit-phone",children:[z("students.phone")," *"]}),(0,b.jsx)(g.Input,{id:"edit-phone",value:Q.phone,onChange:a=>R({...Q,phone:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsxs)(m.Label,{htmlFor:"edit-grade",children:[z("students.grade")," *"]}),(0,b.jsxs)(l.Select,{value:Q.grade,onValueChange:a=>R({...Q,grade:a}),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsx)(l.SelectContent,{children:t.GRADE_OPTIONS.map(a=>(0,b.jsx)(l.SelectItem,{value:a,children:a},a))})]})]})]}),(0,b.jsxs)(k.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{H(!1),N(null),T()},children:z("common.cancel")}),(0,b.jsxs)(f.Button,{onClick:V,disabled:O,children:[O&&(0,b.jsx)(r.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),z("common.save")]})]})]})}),(0,b.jsx)(k.Dialog,{open:I,onOpenChange:J,children:(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:z("common.confirmDelete")}),(0,b.jsx)(k.DialogDescription,{children:z("students.deleteConfirm",{name:M?.name||""})})]}),(0,b.jsxs)("div",{className:"py-4 space-y-3",children:[(0,b.jsx)("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${"soft"===K?"border-primary bg-primary/10":"border-border hover:border-muted-foreground"}`,onClick:()=>L("soft"),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:`w-4 h-4 rounded-full border-2 ${"soft"===K?"border-primary bg-primary":"border-muted-foreground"}`}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:z("students.softDelete")}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:z("students.softDeleteDesc")})]})]})}),(0,b.jsx)("div",{className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${"hard"===K?"border-destructive bg-destructive/10":"border-border hover:border-muted-foreground"}`,onClick:()=>L("hard"),children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:`w-4 h-4 rounded-full border-2 ${"hard"===K?"border-destructive bg-destructive":"border-muted-foreground"}`}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-destructive",children:z("students.hardDelete")}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:z("students.hardDeleteDesc")}),(0,b.jsx)("p",{className:"text-sm text-destructive mt-1",children:z("students.hardDeleteWarning")})]})]})})]}),(0,b.jsxs)(k.DialogFooter,{children:[(0,b.jsx)(f.Button,{variant:"outline",onClick:()=>{J(!1),N(null),L("soft")},children:z("common.cancel")}),(0,b.jsxs)(f.Button,{variant:"hard"===K?"destructive":"default",onClick:()=>W(K),disabled:O,children:[O&&(0,b.jsx)(r.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"hard"===K?z("students.hardDelete"):z("students.softDelete")]})]})]})})]})}a.s(["StudentList",()=>v])}];

//# sourceMappingURL=src_app_%28dashboard%29_students_student-list_tsx_c11bdd15._.js.map