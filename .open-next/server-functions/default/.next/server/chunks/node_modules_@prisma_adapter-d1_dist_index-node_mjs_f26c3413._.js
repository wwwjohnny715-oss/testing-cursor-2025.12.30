module.exports=[56338,t=>{"use strict";var e,r,s,o,n=t.i(54941),a=t.i(86427);class i extends Error{response;request;options;constructor(t,e,r){const s=t.status||0===t.status?t.status:"",o=t.statusText||"",n=`${s} ${o}`.trim();super(`Request failed with ${n?`status code ${n}`:"an unknown error"}: ${e.method} ${e.url}`),this.name="HTTPError",this.response=t,this.request=e,this.options=r}}class l extends Error{request;constructor(t){super(`Request timed out: ${t.method} ${t.url}`),this.name="TimeoutError",this.request=t}}let u=t=>null!==t&&"object"==typeof t,c=(...t)=>{for(let e of t)if((!u(e)||Array.isArray(e))&&void 0!==e)throw TypeError("The `options` argument must be an object");return f({},...t)},p=(t={},e={})=>{let r=new globalThis.Headers(t),s=e instanceof globalThis.Headers;for(let[t,o]of new globalThis.Headers(e).entries())s&&"undefined"===o||void 0===o?r.delete(t):r.set(t,o);return r};function h(t,e,r){return Object.hasOwn(e,r)&&void 0===e[r]?[]:f(t[r]??[],e[r]??[])}let d=(t={},e={})=>({beforeRequest:h(t,e,"beforeRequest"),beforeRetry:h(t,e,"beforeRetry"),afterResponse:h(t,e,"afterResponse"),beforeError:h(t,e,"beforeError")}),f=(...t)=>{let e={},r={},s={};for(let o of t)if(Array.isArray(o))Array.isArray(e)||(e=[]),e=[...e,...o];else if(u(o)){for(let[t,r]of Object.entries(o))u(r)&&t in e&&(r=f(e[t],r)),e={...e,[t]:r};u(o.hooks)&&(s=d(s,o.hooks),e.hooks=s),u(o.headers)&&(r=p(r,o.headers),e.headers=r)}return e},m=(()=>{let t=!1,e=!1,r="function"==typeof globalThis.Request;if("function"==typeof globalThis.ReadableStream&&r)try{e=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type")}catch(t){if(t instanceof Error&&"unsupported BodyInit type"===t.message)return!1;throw t}return t&&!e})(),y="function"==typeof globalThis.AbortController,w="function"==typeof globalThis.ReadableStream,b="function"==typeof globalThis.FormData,g=["get","post","put","patch","head","delete"],_={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},T=Symbol("stop"),E={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},R={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},D={limit:2,methods:["get","put","head","delete","options","trace"],statusCodes:[408,413,429,500,502,503,504],afterStatusCodes:[413,429,503],maxRetryAfter:1/0,backoffLimit:1/0,delay:t=>.3*2**(t-1)*1e3};async function C(t,e,r,s){return new Promise((o,n)=>{let a=setTimeout(()=>{r&&r.abort(),n(new l(t))},s.timeout);s.fetch(t,e).then(o).catch(n).then(()=>{clearTimeout(a)})})}async function v(t,{signal:e}){return new Promise((r,s)=>{function o(){clearTimeout(n),s(e.reason)}e&&(e.throwIfAborted(),e.addEventListener("abort",o,{once:!0}));let n=setTimeout(()=>{e?.removeEventListener("abort",o),r()},t)})}class A{static create(t,e){let r=new A(t,e),s=async()=>{if("number"==typeof r._options.timeout&&r._options.timeout>0x7fffffff)throw RangeError("The `timeout` option cannot be greater than 2147483647");await Promise.resolve();let t=await r._fetch();for(let e of r._options.hooks.afterResponse){let s=await e(r.request,r._options,r._decorateResponse(t.clone()));s instanceof globalThis.Response&&(t=s)}if(r._decorateResponse(t),!t.ok&&r._options.throwHttpErrors){let e=new i(t,r.request,r._options);for(let t of r._options.hooks.beforeError)e=await t(e);throw e}if(r._options.onDownloadProgress){if("function"!=typeof r._options.onDownloadProgress)throw TypeError("The `onDownloadProgress` option must be a function");if(!w)throw Error("Streams are not supported in your environment. `ReadableStream` is missing.");return r._stream(t.clone(),r._options.onDownloadProgress)}return t},o=r._options.retry.methods.includes(r.request.method.toLowerCase())?r._retry(s):s();for(let[t,s]of Object.entries(_))o[t]=async()=>{r.request.headers.set("accept",r.request.headers.get("accept")||s);let n=await o;if("json"===t){if(204===n.status||0===(await n.clone().arrayBuffer()).byteLength)return"";if(e.parseJson)return e.parseJson(await n.text())}return n[t]()};return o}request;abortController;_retryCount=0;_input;_options;constructor(t,e={}){if(this._input=t,this._options={...e,headers:p(this._input.headers,e.headers),hooks:d({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},e.hooks),method:(t=>g.includes(t)?t.toUpperCase():t)(e.method??this._input.method??"GET"),prefixUrl:String(e.prefixUrl||""),retry:((t={})=>{if("number"==typeof t)return{...D,limit:t};if(t.methods&&!Array.isArray(t.methods))throw Error("retry.methods must be an array");if(t.statusCodes&&!Array.isArray(t.statusCodes))throw Error("retry.statusCodes must be an array");return{...D,...t}})(e.retry),throwHttpErrors:!1!==e.throwHttpErrors,timeout:e.timeout??1e4,fetch:e.fetch??globalThis.fetch.bind(globalThis)},"string"!=typeof this._input&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&"string"==typeof this._input){if(this._input.startsWith("/"))throw Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(y){this.abortController=new globalThis.AbortController;const t=this._options.signal??this._input.signal;t?.aborted&&this.abortController.abort(t?.reason),t?.addEventListener("abort",()=>{this.abortController.abort(t.reason)}),this._options.signal=this.abortController.signal}if(m&&(this._options.duplex="half"),void 0!==this._options.json&&(this._options.body=this._options.stringifyJson?.(this._options.json)??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const t="string"==typeof this._options.searchParams?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString(),e=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,"?"+t);(b&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(e,{...this.request}),this._options)}}_calculateRetryDelay(t){if(this._retryCount++,this._retryCount>this._options.retry.limit||t instanceof l)throw t;if(t instanceof i){if(!this._options.retry.statusCodes.includes(t.response.status))throw t;let e=t.response.headers.get("Retry-After")??t.response.headers.get("RateLimit-Reset")??t.response.headers.get("X-RateLimit-Reset")??t.response.headers.get("X-Rate-Limit-Reset");if(e&&this._options.retry.afterStatusCodes.includes(t.response.status)){let t=1e3*Number(e);Number.isNaN(t)?t=Date.parse(e)-Date.now():t>=Date.parse("2024-01-01")&&(t-=Date.now());let r=this._options.retry.maxRetryAfter??t;return t<r?t:r}if(413===t.response.status)throw t}let e=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,e)}_decorateResponse(t){return this._options.parseJson&&(t.json=async()=>this._options.parseJson(await t.text())),t}async _retry(t){try{return await t()}catch(r){let e=Math.min(this._calculateRetryDelay(r),0x7fffffff);if(this._retryCount<1)throw r;for(let t of(await v(e,{signal:this._options.signal}),this._options.hooks.beforeRetry))if(await t({request:this.request,options:this._options,error:r,retryCount:this._retryCount})===T)return;return this._retry(t)}}async _fetch(){for(let t of this._options.hooks.beforeRequest){let e=await t(this.request,this._options);if(e instanceof Request){this.request=e;break}if(e instanceof Response)return e}let t=((t,e)=>{let r={};for(let s in e)s in R||s in E||s in t||(r[s]=e[s]);return r})(this.request,this._options),e=this.request;return(this.request=e.clone(),!1===this._options.timeout)?this._options.fetch(e,t):C(e,t,this.abortController,this._options)}_stream(t,e){let r=Number(t.headers.get("content-length"))||0,s=0;return 204===t.status?(e&&e({percent:1,totalBytes:r,transferredBytes:s},new Uint8Array),new globalThis.Response(null,{status:t.status,statusText:t.statusText,headers:t.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(o){let n=t.body.getReader();async function a(){let{done:t,value:i}=await n.read();t?o.close():(e&&(s+=i.byteLength,e({percent:0===r?0:s/r,transferredBytes:s,totalBytes:r},i)),o.enqueue(i),await a())}e&&e({percent:0,transferredBytes:0,totalBytes:r},new Uint8Array),await a()}}),{status:t.status,statusText:t.statusText,headers:t.headers})}}let q=t=>{let e=(e,r)=>A.create(e,c(t,r));for(let r of g)e[r]=(e,s)=>A.create(e,c(t,s,{method:r}));return e.create=t=>q(c(t)),e.extend=e=>("function"==typeof e&&(e=e(t??{})),q(c(t,e))),e.stop=T,e},x=q();var O=t.i(2157),I=t.i(50227),j="@prisma/adapter-d1",L=!0;"undefined"!=typeof process&&({FORCE_COLOR:e,NODE_DISABLE_COLORS:r,NO_COLOR:s,TERM:o}=process.env||{},L=process.stdout&&process.stdout.isTTY);var S={enabled:!r&&null==s&&"dumb"!==o&&(null!=e&&"0"!==e||L)};function U(t,e){let r=RegExp(`\\x1b\\[${e}m`,"g"),s=`\x1b[${t}m`,o=`\x1b[${e}m`;return function(t){return S.enabled&&null!=t?s+(~(""+t).indexOf(o)?t.replace(r,o+s):t)+o:t}}U(0,0),U(1,22),U(2,22),U(3,23),U(4,24),U(7,27),U(8,28),U(9,29),U(30,39);var $=U(31,39);U(32,39);var N=U(33,39),k=U(34,39);U(35,39);var P=U(36,39);function W(t,e){let r=[];t:for(let s=0;s<t.length;s++){for(let t=0;t<e.length;t++){let o=e[t][s];if(null!==o){let t=function(t){switch(typeof t){case"string":return function(t){return F.test(t)||B.test(t)?a.ColumnTypeEnum.DateTime:a.ColumnTypeEnum.Text}(t);case"number":return a.ColumnTypeEnum.UnknownNumber;case"object":var e=t;if(e instanceof Array)return a.ColumnTypeEnum.Bytes;throw new H(e);default:throw new H(t)}}(o);if((void 0===r[s]||t===a.ColumnTypeEnum.Text)&&(r[s]=t),t!==a.ColumnTypeEnum.UnknownNumber)continue t}}void 0===r[s]&&(r[s]=a.ColumnTypeEnum.Int32)}return r}U(37,39),U(90,39),U(90,39),U(40,49),U(41,49),U(42,49),U(43,49),U(44,49),U(45,49),U(46,49),U(47,49);var F=new RegExp(/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))$|^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$|^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/),B=/^\d{4}-[0-1]\d-[0-3]\d [0-2]\d:[0-5]\d:[0-5]\d$/,H=class extends Error{name="UnexpectedTypeError";constructor(t){const e=typeof t;super(`unexpected value of type ${e}: ${"object"===e?JSON.stringify(t):String(t)}`)}};function J(t,e){for(let r=0;r<t.length;r++){let s=t[r];if(s instanceof ArrayBuffer){t[r]=new Uint8Array(s);continue}if("number"==typeof s&&(e[r]===a.ColumnTypeEnum.Int32||e[r]===a.ColumnTypeEnum.Int64)&&!Number.isInteger(s)){t[r]=Math.trunc(s);continue}if("number"==typeof s&&e[r]===a.ColumnTypeEnum.Text||"bigint"==typeof s){t[r]=s.toString();continue}e[r]===a.ColumnTypeEnum.Boolean&&(t[r]=JSON.parse(s))}return t}function K(t,e){if(null===t)return null;if("bigint"==typeof t||"bigint"===e.scalarType){let e=Number.parseInt(`${t}`);if(!Number.isSafeInteger(e))throw Error(`Invalid Int64-encoded value received: ${t}`);return e}return"string"==typeof t&&"int"===e.scalarType?Number.parseInt(t):"string"==typeof t&&"float"===e.scalarType||"string"==typeof t&&"decimal"===e.scalarType?Number.parseFloat(t):!0===t?1:!1===t?0:("string"==typeof t&&"datetime"===e.scalarType&&(t=new Date(t)),t instanceof Date)?t.toISOString().replace("Z","+00:00"):"string"==typeof t&&"bytes"===e.scalarType?Array.from(Buffer.from(t,"base64")):t instanceof Uint8Array?Array.from(t):t}function Z(t){if("string"==typeof t.message)return{originalMessage:t.message,...function(t){let e=t.message.split("D1_ERROR: ").at(1)??t.message;if((e=e.split("SqliteError: ").at(1)??e).startsWith("UNIQUE constraint failed")||e.startsWith("PRIMARY KEY constraint failed")){let t=e.split(": ").at(1)?.split(", ").map(t=>t.split(".").pop());return{kind:"UniqueConstraintViolation",constraint:void 0!==t?{fields:t}:void 0}}if(e.startsWith("NOT NULL constraint failed")){let t=e.split(": ").at(1)?.split(", ").map(t=>t.split(".").pop());return{kind:"NullConstraintViolation",constraint:void 0!==t?{fields:t}:void 0}}if(e.startsWith("FOREIGN KEY constraint failed")||e.startsWith("CHECK constraint failed"))return{kind:"ForeignKeyConstraintViolation",constraint:{foreignKey:{}}};if(e.startsWith("no such table"))return{kind:"TableDoesNotExist",table:e.split(": ").at(1)};if(e.startsWith("no such column"))return{kind:"ColumnNotFound",column:e.split(": ").at(1)};else if(e.includes("has no column named "))return{kind:"ColumnNotFound",column:e.split("has no column named ").at(1)};return{kind:"sqlite",extendedCode:t.code??t.cause?.code??1,message:t.message}}(t)};throw t}var M=(0,n.Debug)("prisma:driver-adapter:d1-http");function V({errors:t}){M("D1 HTTP Errors: %O",t);let e=t.at(0)??{message:"Unknown error",code:1};throw new a.DriverAdapterError(Z(e))}function Q(t){throw M("HTTP Error: %O",t),new a.DriverAdapterError(Z(t))}function Y(t){throw console.error("Error in performIO: %O",t),new a.DriverAdapterError(Z(t))}async function z(t,e){try{let r=await t.post("raw",e).json();return M("[js::performRawQuery] %O",{success:r.success,errors:r.errors,messages:r.messages,result:r.result}),r.success||V(r),r.result}catch(t){Q(t)}}var G=class{constructor(t){this.client=t}provider="sqlite";adapterName=`${j}-http`;async queryRaw(t){M("[js::query_raw] %O",t);let e=await this.performIO(t);return this.convertData(e)}convertData({columnNames:t,rows:e}){if(0===e.length)return{columnNames:[],columnTypes:[],rows:[]};let r=W(t,e),s=e.map(t=>J(t,r));return{columnNames:t,columnTypes:r,rows:s}}async executeRaw(t){return M("[js::execute_raw] %O",t),(await this.performIO(t)).affectedRows??0}async performIO(t){try{let e={json:{sql:t.sql,params:t.args.map((e,r)=>K(e,t.argTypes[r]))}};M("[js::perform_io] %O",e);let r=await z(this.client,e);if(1!==r.length)throw Error("Expected exactly one result");let s=r[0],{columns:o=[],rows:n=[]}=s.results??{},a=s.meta?.changes;return{rows:n,columnNames:o,affectedRows:a}}catch(t){Y(t)}}},X=class extends G{constructor(t,e){super(t),this.options=e}async commit(){M("[js::commit]")}async rollback(){M("[js::rollback]")}},tt=class extends G{constructor(t,e){super(x.create({prefixUrl:`https://api.cloudflare.com/client/v4/accounts/${t.CLOUDFLARE_ACCOUNT_ID}/d1/database/${t.CLOUDFLARE_DATABASE_ID}`,headers:{Authorization:`Bearer ${t.CLOUDFLARE_D1_TOKEN}`},throwHttpErrors:!1})),this.release=e}tags={error:$("prisma:error"),warn:N("prisma:warn"),info:P("prisma:info"),query:k("prisma:query")};alreadyWarned=new Set;warnOnce=(t,e,...r)=>{this.alreadyWarned.has(t)||(this.alreadyWarned.add(t),console.info(`${this.tags.warn} ${e}`,...r))};async executeScript(t){try{await z(this.client,{json:{sql:t}})}catch(t){Y(t)}}getConnectionInfo(){return{maxBindValues:98,supportsRelationJoins:!1}}async startTransaction(t){if(t&&"SERIALIZABLE"!==t)throw new a.DriverAdapterError({kind:"InvalidIsolationLevel",level:t});this.warnOnce("D1 Transaction","Cloudflare D1 does not support transactions yet. When using Prisma's D1 adapter, implicit & explicit transactions will be ignored and run as individual queries, which breaks the guarantees of the ACID properties of transactions. For more details see https://pris.ly/d/d1-transactions");let e={usePhantomQuery:!0};return M("%s options: %O","[js::startTransaction]",e),new X(this.client,e)}async dispose(){await this.release?.()}},te=class{constructor(t){this.params=t}provider="sqlite";adapterName=`${j}-http`;async connect(){return new tt(this.params,async()=>{})}async connectToShadowDb(){let t=`https://api.cloudflare.com/client/v4/accounts/${this.params.CLOUDFLARE_ACCOUNT_ID}/d1/database`,e=x.create({headers:{Authorization:`Bearer ${this.params.CLOUDFLARE_D1_TOKEN}`},throwHttpErrors:!1}),r=async()=>{let r="[js::connectToShadowDb::createShadowDatabase]",s=`_prisma_shadow_${globalThis.crypto.randomUUID()}`;M(`${r} creating database %s`,s);try{let o=await e.post(t,{json:{name:s}}).json();M(`${r} %O`,o),o.success||V(o);let{uuid:n}=o.result;return M(`${r} created database %s with ID %s`,s,n),n}catch(t){Q(t)}},s=this.params.CLOUDFLARE_SHADOW_DATABASE_ID??await r(),o=async()=>{let r="[js::connectToShadowDb::dispose]";try{M(`${r} deleting database %s`,s);let o=await e.delete(`${t}/${s}`).json();M(`${r} %O`,o),o.success||V(o)}catch(t){Q(t)}};return new tt(this.params,o)}},tr=(0,n.Debug)("prisma:driver-adapter:d1"),ts=class{constructor(t){this.client=t}provider="sqlite";adapterName=j;async queryRaw(t){tr("[js::query_raw] %O",t);let e=await this.performIO(t);return this.convertData(e)}convertData(t){let e=t[0],r=t[1];if(0===r.length)return{columnNames:[],columnTypes:[],rows:[]};let s=Object.values(W(e,r)),o=r.map(t=>J(t,s));return{columnNames:e,columnTypes:s,rows:o}}async executeRaw(t){return tr("[js::execute_raw] %O",t),(await this.performIO(t,!0)).meta.changes??0}async performIO(t,e=!1){try{let r=t.args.map((e,r)=>K(e,t.argTypes[r])),s=this.client.prepare(t.sql).bind(...r);if(e)return await s.run();{let[t,...e]=await s.raw({columnNames:!0});return[t,e]}}catch(t){ti(t)}}},to=class extends ts{constructor(t,e){super(t),this.options=e}async commit(){tr("[js::commit]")}async rollback(){tr("[js::rollback]")}},tn=class extends ts{constructor(t,e){super(t),this.release=e}tags={error:$("prisma:error"),warn:N("prisma:warn"),info:P("prisma:info"),query:k("prisma:query")};alreadyWarned=new Set;warnOnce=(t,e,...r)=>{this.alreadyWarned.has(t)||(this.alreadyWarned.add(t),console.info(`${this.tags.warn} ${e}`,...r))};async executeScript(t){try{await this.client.exec(t)}catch(t){ti(t)}}getConnectionInfo(){return{maxBindValues:98,supportsRelationJoins:!1}}async startTransaction(t){if(t&&"SERIALIZABLE"!==t)throw new a.DriverAdapterError({kind:"InvalidIsolationLevel",level:t});this.warnOnce("D1 Transaction","Cloudflare D1 does not support transactions yet. When using Prisma's D1 adapter, implicit & explicit transactions will be ignored and run as individual queries, which breaks the guarantees of the ACID properties of transactions. For more details see https://pris.ly/d/d1-transactions");let e={usePhantomQuery:!0};return tr("%s options: %O","[js::startTransaction]",e),new to(this.client,e)}async dispose(){await this.release?.()}},ta=class{constructor(t){this.client=t}provider="sqlite";adapterName=j;async connect(){return new tn(this.client,async()=>{})}};function ti(t){throw console.error("Error in performIO: %O",t),new a.DriverAdapterError(Z(t))}var tl=class{provider="sqlite";adapterName=j;connect;connectToShadowDb;constructor(t){if(function(t){return"object"==typeof t&&null!==t&&"CLOUDFLARE_D1_TOKEN"in t&&"CLOUDFLARE_ACCOUNT_ID"in t&&"CLOUDFLARE_DATABASE_ID"in t}(t)){const e=new te(t);this.connect=e.connect.bind(e),this.connectToShadowDb=e.connectToShadowDb.bind(e)}else{const e=new ta(t);this.connect=e.connect.bind(e)}}},tu=I.default.join(".wrangler","state","v3","d1","miniflare-D1DatabaseObject");function tc(){let t=process.cwd(),e=I.default.join(t,tu);return O.default.readdirSync(e).filter(t=>t.endsWith(".sqlite")).map(t=>I.default.join(e,t))}t.s(["PrismaD1",()=>tl,"PrismaD1Http",()=>te,"listLocalDatabases",()=>tc],56338)}];

//# sourceMappingURL=node_modules_%40prisma_adapter-d1_dist_index-node_mjs_f26c3413._.js.map