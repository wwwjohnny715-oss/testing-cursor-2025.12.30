module.exports=[10283,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246),f=a.i(15925),g=a.i(99570),h=a.i(86304),i=a.i(91119),j=a.i(6015),k=a.i(14574),l=a.i(80701),m=a.i(70430),n=a.i(70106);let o=(0,n.default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),p=(0,n.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),q=(0,n.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var r=a.i(96221);let s=(0,n.default)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);var t=a.i(23292),u=a.i(56711);function v({course:a,pastSessions:n,canEdit:v}){let w=(0,d.useRouter)(),x=(0,f.useTranslations)(),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)("present"),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(!1),K=a.enrollments.filter(a=>a.is_active).map(a=>a.student),L=b=>{let c=[];for(let d of a.sessions){let a=d.attendances.find(a=>a.student.id===b);c.push({session:d,status:a?.status||null})}return c},M=async()=>{if(!C||!G)return void t.toast.error(x("common.fillRequired"));J(!0);try{let a=await fetch("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:G,student_id:C.id,status:E})});if(!a.ok){let b=await a.json();throw Error(b.error||x("common.operationFailed"))}t.toast.success(x("attendance.markSuccess")),z(!1),D(null),H(""),w.refresh()}catch(a){t.toast.error(a instanceof Error?a.message:x("common.operationFailed"))}finally{J(!1)}};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(e.default,{href:"/courses",children:(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(o,{className:"h-5 w-5"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:a.courseCode}),(0,b.jsxs)("p",{className:"text-muted-foreground",children:[x("courses.teacher"),": ",a.teacher.name," (",a.teacher.teacherCode,")"]})]}),a.is_deleted&&(0,b.jsx)(h.Badge,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:x("courses.deleted")})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:x("courses.courseInfo")})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:x("courses.grades")}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:(function(a){if(!a)return[];if(Array.isArray(a))return a;if("string"==typeof a)try{let b=JSON.parse(a);return Array.isArray(b)?b:[]}catch{}return[]})(a.grades).map(a=>(0,b.jsx)(h.Badge,{variant:"outline",children:a},a))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:x("courses.sessions")}),(0,b.jsx)("p",{className:"font-medium",children:a.sessions.length})]})]})})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsx)(i.CardTitle,{children:x("courses.sessions")}),(0,b.jsx)(i.CardDescription,{children:x("courses.viewDetails")})]}),(0,b.jsx)(i.CardContent,{children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Session Code"}),(0,b.jsx)(j.TableHead,{children:x("courses.date")}),(0,b.jsx)(j.TableHead,{children:x("courses.startTime")}),(0,b.jsx)(j.TableHead,{children:x("courses.duration")}),(0,b.jsx)(j.TableHead,{children:x("attendance.title")})]})}),(0,b.jsx)(j.TableBody,{children:a.sessions.map(a=>{let c=new Date(a.date)<new Date;return(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-mono",children:a.sessionCode}),(0,b.jsx)(j.TableCell,{children:(0,u.format)(new Date(a.date),"yyyy/MM/dd")}),(0,b.jsxs)(j.TableCell,{children:[a.start_time," - ",a.end_time]}),(0,b.jsxs)(j.TableCell,{children:[a.duration_minutes," 分钟"]}),(0,b.jsx)(j.TableCell,{children:c?(0,b.jsxs)("span",{children:[a.attendances.length," / ",K.length]}):(0,b.jsx)("span",{className:"text-muted-foreground",children:"未开始"})})]},a.id)})})]})})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsx)(i.CardTitle,{children:x("courses.enrolledStudents")}),(0,b.jsx)(i.CardDescription,{children:x("courses.activeStudents")})]}),(0,b.jsx)(i.CardContent,{children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:x("students.studentCode")}),(0,b.jsx)(j.TableHead,{children:x("students.name")}),(0,b.jsx)(j.TableHead,{children:x("students.grade")}),(0,b.jsx)(j.TableHead,{children:x("attendance.title")}),v&&(0,b.jsx)(j.TableHead,{className:"text-right",children:x("common.actions")})]})}),(0,b.jsx)(j.TableBody,{children:0===K.length?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:v?5:4,className:"h-24 text-center text-muted-foreground",children:x("students.noStudents")})}):K.map(a=>{let c=L(a.id),d=c.filter(a=>"present"===a.status).length,e=c.filter(a=>"absent"===a.status).length,f=n.length;return(0,b.jsxs)(j.TableRow,{className:"group",children:[(0,b.jsx)(j.TableCell,{className:"font-mono",children:a.studentCode}),(0,b.jsx)(j.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(h.Badge,{variant:"outline",children:a.grade})}),(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-green-400 flex items-center gap-1",children:[(0,b.jsx)(p,{className:"h-3 w-3"}),d]}),(0,b.jsxs)("span",{className:"text-red-400 flex items-center gap-1",children:[(0,b.jsx)(q,{className:"h-3 w-3"}),e]}),(0,b.jsxs)("span",{className:"text-muted-foreground text-sm",children:["/ ",f]})]})}),v&&(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>{D(a),B(!0)},children:"历史"}),n.length>0&&(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>{D(a),F("present"),H(""),z(!0)},children:[(0,b.jsx)(s,{className:"h-4 w-4 mr-1"}),x("attendance.markAttendance")]})]})})]},a.id)})})]})})]}),(0,b.jsx)(k.Dialog,{open:y,onOpenChange:z,children:(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:x("attendance.markAttendance")}),(0,b.jsxs)(k.DialogDescription,{children:[x("students.name"),": ",C?.name," (",C?.studentCode,")"]})]}),(0,b.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(m.Label,{children:x("attendance.selectStatus")}),(0,b.jsxs)(l.Select,{value:E,onValueChange:a=>F(a),children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"present",children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(p,{className:"h-4 w-4 text-green-400"}),x("attendance.present")]})}),(0,b.jsx)(l.SelectItem,{value:"absent",children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)(q,{className:"h-4 w-4 text-red-400"}),x("attendance.absent")]})})]})]})]}),(0,b.jsxs)("div",{className:"grid gap-2",children:[(0,b.jsx)(m.Label,{children:x("attendance.selectSession")}),(0,b.jsxs)(l.Select,{value:G,onValueChange:H,children:[(0,b.jsx)(l.SelectTrigger,{children:(0,b.jsx)(l.SelectValue,{placeholder:x("attendance.selectSession")})}),(0,b.jsx)(l.SelectContent,{children:n.map(a=>(0,b.jsxs)(l.SelectItem,{value:a.id,children:[a.sessionCode," (",(0,u.format)(new Date(a.date),"yyyy/MM/dd"),")"]},a.id))})]})]})]}),(0,b.jsxs)(k.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>{z(!1),D(null)},children:x("common.cancel")}),(0,b.jsxs)(g.Button,{onClick:M,disabled:I||!G,children:[I&&(0,b.jsx)(r.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),x("common.confirm")]})]})]})}),(0,b.jsx)(k.Dialog,{open:A,onOpenChange:B,children:(0,b.jsxs)(k.DialogContent,{className:"max-w-lg",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:x("attendance.attendanceHistory")}),(0,b.jsxs)(k.DialogDescription,{children:[x("students.name"),": ",C?.name," (",C?.studentCode,")"]})]}),(0,b.jsx)("div",{className:"max-h-[400px] overflow-y-auto",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableHead,{children:"Session"}),(0,b.jsx)(j.TableHead,{children:"日期"}),(0,b.jsx)(j.TableHead,{children:"状态"})]})}),(0,b.jsx)(j.TableBody,{children:C&&L(C.id).map(({session:a,status:c})=>(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-mono text-sm",children:a.sessionCode}),(0,b.jsx)(j.TableCell,{children:(0,u.format)(new Date(a.date),"yyyy/MM/dd")}),(0,b.jsx)(j.TableCell,{children:"present"===c?(0,b.jsx)(h.Badge,{className:"bg-green-500/20 text-green-400 border-green-500/30",children:x("attendance.present")}):"absent"===c?(0,b.jsx)(h.Badge,{className:"bg-red-500/20 text-red-400 border-red-500/30",children:x("attendance.absent")}):(0,b.jsx)(h.Badge,{variant:"outline",className:"text-muted-foreground",children:"-"})})]},a.id))})]})}),(0,b.jsx)(k.DialogFooter,{children:(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>{B(!1),D(null)},children:"关闭"})})]})})]})}a.s(["CourseDetail",()=>v],10283)}];

//# sourceMappingURL=src_app_%28dashboard%29_courses_%5BcourseId%5D_course-detail_tsx_02010009._.js.map