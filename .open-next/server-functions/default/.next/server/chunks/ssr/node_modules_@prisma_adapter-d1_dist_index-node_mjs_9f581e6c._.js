module.exports=[3292,a=>{"use strict";var b,c,d,e,f=a.i(71655),g=a.i(27029);class h extends Error{response;request;options;constructor(a,b,c){const d=a.status||0===a.status?a.status:"",e=a.statusText||"",f=`${d} ${e}`.trim();super(`Request failed with ${f?`status code ${f}`:"an unknown error"}: ${b.method} ${b.url}`),this.name="HTTPError",this.response=a,this.request=b,this.options=c}}class i extends Error{request;constructor(a){super(`Request timed out: ${a.method} ${a.url}`),this.name="TimeoutError",this.request=a}}let j=a=>null!==a&&"object"==typeof a,k=(...a)=>{for(let b of a)if((!j(b)||Array.isArray(b))&&void 0!==b)throw TypeError("The `options` argument must be an object");return o({},...a)},l=(a={},b={})=>{let c=new globalThis.Headers(a),d=b instanceof globalThis.Headers;for(let[a,e]of new globalThis.Headers(b).entries())d&&"undefined"===e||void 0===e?c.delete(a):c.set(a,e);return c};function m(a,b,c){return Object.hasOwn(b,c)&&void 0===b[c]?[]:o(a[c]??[],b[c]??[])}let n=(a={},b={})=>({beforeRequest:m(a,b,"beforeRequest"),beforeRetry:m(a,b,"beforeRetry"),afterResponse:m(a,b,"afterResponse"),beforeError:m(a,b,"beforeError")}),o=(...a)=>{let b={},c={},d={};for(let e of a)if(Array.isArray(e))Array.isArray(b)||(b=[]),b=[...b,...e];else if(j(e)){for(let[a,c]of Object.entries(e))j(c)&&a in b&&(c=o(b[a],c)),b={...b,[a]:c};j(e.hooks)&&(d=n(d,e.hooks),b.hooks=d),j(e.headers)&&(c=l(c,e.headers),b.headers=c)}return b},p=(()=>{let a=!1,b=!1,c="function"==typeof globalThis.Request;if("function"==typeof globalThis.ReadableStream&&c)try{b=new globalThis.Request("https://empty.invalid",{body:new globalThis.ReadableStream,method:"POST",get duplex(){return a=!0,"half"}}).headers.has("Content-Type")}catch(a){if(a instanceof Error&&"unsupported BodyInit type"===a.message)return!1;throw a}return a&&!b})(),q="function"==typeof globalThis.AbortController,r="function"==typeof globalThis.ReadableStream,s="function"==typeof globalThis.FormData,t=["get","post","put","patch","head","delete"],u={json:"application/json",text:"text/*",formData:"multipart/form-data",arrayBuffer:"*/*",blob:"*/*"},v=Symbol("stop"),w={json:!0,parseJson:!0,stringifyJson:!0,searchParams:!0,prefixUrl:!0,retry:!0,timeout:!0,hooks:!0,throwHttpErrors:!0,onDownloadProgress:!0,fetch:!0},x={method:!0,headers:!0,body:!0,mode:!0,credentials:!0,cache:!0,redirect:!0,referrer:!0,referrerPolicy:!0,integrity:!0,keepalive:!0,signal:!0,window:!0,dispatcher:!0,duplex:!0,priority:!0},y={limit:2,methods:["get","put","head","delete","options","trace"],statusCodes:[408,413,429,500,502,503,504],afterStatusCodes:[413,429,503],maxRetryAfter:1/0,backoffLimit:1/0,delay:a=>.3*2**(a-1)*1e3};async function z(a,b,c,d){return new Promise((e,f)=>{let g=setTimeout(()=>{c&&c.abort(),f(new i(a))},d.timeout);d.fetch(a,b).then(e).catch(f).then(()=>{clearTimeout(g)})})}async function A(a,{signal:b}){return new Promise((c,d)=>{function e(){clearTimeout(f),d(b.reason)}b&&(b.throwIfAborted(),b.addEventListener("abort",e,{once:!0}));let f=setTimeout(()=>{b?.removeEventListener("abort",e),c()},a)})}class B{static create(a,b){let c=new B(a,b),d=async()=>{if("number"==typeof c._options.timeout&&c._options.timeout>0x7fffffff)throw RangeError("The `timeout` option cannot be greater than 2147483647");await Promise.resolve();let a=await c._fetch();for(let b of c._options.hooks.afterResponse){let d=await b(c.request,c._options,c._decorateResponse(a.clone()));d instanceof globalThis.Response&&(a=d)}if(c._decorateResponse(a),!a.ok&&c._options.throwHttpErrors){let b=new h(a,c.request,c._options);for(let a of c._options.hooks.beforeError)b=await a(b);throw b}if(c._options.onDownloadProgress){if("function"!=typeof c._options.onDownloadProgress)throw TypeError("The `onDownloadProgress` option must be a function");if(!r)throw Error("Streams are not supported in your environment. `ReadableStream` is missing.");return c._stream(a.clone(),c._options.onDownloadProgress)}return a},e=c._options.retry.methods.includes(c.request.method.toLowerCase())?c._retry(d):d();for(let[a,d]of Object.entries(u))e[a]=async()=>{c.request.headers.set("accept",c.request.headers.get("accept")||d);let f=await e;if("json"===a){if(204===f.status||0===(await f.clone().arrayBuffer()).byteLength)return"";if(b.parseJson)return b.parseJson(await f.text())}return f[a]()};return e}request;abortController;_retryCount=0;_input;_options;constructor(a,b={}){if(this._input=a,this._options={...b,headers:l(this._input.headers,b.headers),hooks:n({beforeRequest:[],beforeRetry:[],beforeError:[],afterResponse:[]},b.hooks),method:(a=>t.includes(a)?a.toUpperCase():a)(b.method??this._input.method??"GET"),prefixUrl:String(b.prefixUrl||""),retry:((a={})=>{if("number"==typeof a)return{...y,limit:a};if(a.methods&&!Array.isArray(a.methods))throw Error("retry.methods must be an array");if(a.statusCodes&&!Array.isArray(a.statusCodes))throw Error("retry.statusCodes must be an array");return{...y,...a}})(b.retry),throwHttpErrors:!1!==b.throwHttpErrors,timeout:b.timeout??1e4,fetch:b.fetch??globalThis.fetch.bind(globalThis)},"string"!=typeof this._input&&!(this._input instanceof URL||this._input instanceof globalThis.Request))throw TypeError("`input` must be a string, URL, or Request");if(this._options.prefixUrl&&"string"==typeof this._input){if(this._input.startsWith("/"))throw Error("`input` must not begin with a slash when using `prefixUrl`");this._options.prefixUrl.endsWith("/")||(this._options.prefixUrl+="/"),this._input=this._options.prefixUrl+this._input}if(q){this.abortController=new globalThis.AbortController;const a=this._options.signal??this._input.signal;a?.aborted&&this.abortController.abort(a?.reason),a?.addEventListener("abort",()=>{this.abortController.abort(a.reason)}),this._options.signal=this.abortController.signal}if(p&&(this._options.duplex="half"),void 0!==this._options.json&&(this._options.body=this._options.stringifyJson?.(this._options.json)??JSON.stringify(this._options.json),this._options.headers.set("content-type",this._options.headers.get("content-type")??"application/json")),this.request=new globalThis.Request(this._input,this._options),this._options.searchParams){const a="string"==typeof this._options.searchParams?this._options.searchParams.replace(/^\?/,""):new URLSearchParams(this._options.searchParams).toString(),b=this.request.url.replace(/(?:\?.*?)?(?=#|$)/,"?"+a);(s&&this._options.body instanceof globalThis.FormData||this._options.body instanceof URLSearchParams)&&!(this._options.headers&&this._options.headers["content-type"])&&this.request.headers.delete("content-type"),this.request=new globalThis.Request(new globalThis.Request(b,{...this.request}),this._options)}}_calculateRetryDelay(a){if(this._retryCount++,this._retryCount>this._options.retry.limit||a instanceof i)throw a;if(a instanceof h){if(!this._options.retry.statusCodes.includes(a.response.status))throw a;let b=a.response.headers.get("Retry-After")??a.response.headers.get("RateLimit-Reset")??a.response.headers.get("X-RateLimit-Reset")??a.response.headers.get("X-Rate-Limit-Reset");if(b&&this._options.retry.afterStatusCodes.includes(a.response.status)){let a=1e3*Number(b);Number.isNaN(a)?a=Date.parse(b)-Date.now():a>=Date.parse("2024-01-01")&&(a-=Date.now());let c=this._options.retry.maxRetryAfter??a;return a<c?a:c}if(413===a.response.status)throw a}let b=this._options.retry.delay(this._retryCount);return Math.min(this._options.retry.backoffLimit,b)}_decorateResponse(a){return this._options.parseJson&&(a.json=async()=>this._options.parseJson(await a.text())),a}async _retry(a){try{return await a()}catch(c){let b=Math.min(this._calculateRetryDelay(c),0x7fffffff);if(this._retryCount<1)throw c;for(let a of(await A(b,{signal:this._options.signal}),this._options.hooks.beforeRetry))if(await a({request:this.request,options:this._options,error:c,retryCount:this._retryCount})===v)return;return this._retry(a)}}async _fetch(){for(let a of this._options.hooks.beforeRequest){let b=await a(this.request,this._options);if(b instanceof Request){this.request=b;break}if(b instanceof Response)return b}let a=((a,b)=>{let c={};for(let d in b)d in x||d in w||d in a||(c[d]=b[d]);return c})(this.request,this._options),b=this.request;return(this.request=b.clone(),!1===this._options.timeout)?this._options.fetch(b,a):z(b,a,this.abortController,this._options)}_stream(a,b){let c=Number(a.headers.get("content-length"))||0,d=0;return 204===a.status?(b&&b({percent:1,totalBytes:c,transferredBytes:d},new Uint8Array),new globalThis.Response(null,{status:a.status,statusText:a.statusText,headers:a.headers})):new globalThis.Response(new globalThis.ReadableStream({async start(e){let f=a.body.getReader();async function g(){let{done:a,value:h}=await f.read();a?e.close():(b&&(d+=h.byteLength,b({percent:0===c?0:d/c,transferredBytes:d,totalBytes:c},h)),e.enqueue(h),await g())}b&&b({percent:0,transferredBytes:0,totalBytes:c},new Uint8Array),await g()}}),{status:a.status,statusText:a.statusText,headers:a.headers})}}let C=a=>{let b=(b,c)=>B.create(b,k(a,c));for(let c of t)b[c]=(b,d)=>B.create(b,k(a,d,{method:c}));return b.create=a=>C(k(a)),b.extend=b=>("function"==typeof b&&(b=b(a??{})),C(k(a,b))),b.stop=v,b},D=C();var E=a.i(2157),F=a.i(50227),G="@prisma/adapter-d1",H=!0;"undefined"!=typeof process&&({FORCE_COLOR:b,NODE_DISABLE_COLORS:c,NO_COLOR:d,TERM:e}=process.env||{},H=process.stdout&&process.stdout.isTTY);var I={enabled:!c&&null==d&&"dumb"!==e&&(null!=b&&"0"!==b||H)};function J(a,b){let c=RegExp(`\\x1b\\[${b}m`,"g"),d=`\x1b[${a}m`,e=`\x1b[${b}m`;return function(a){return I.enabled&&null!=a?d+(~(""+a).indexOf(e)?a.replace(c,e+d):a)+e:a}}J(0,0),J(1,22),J(2,22),J(3,23),J(4,24),J(7,27),J(8,28),J(9,29),J(30,39);var K=J(31,39);J(32,39);var L=J(33,39),M=J(34,39);J(35,39);var N=J(36,39);function O(a,b){let c=[];a:for(let d=0;d<a.length;d++){for(let a=0;a<b.length;a++){let e=b[a][d];if(null!==e){let a=function(a){switch(typeof a){case"string":return function(a){return P.test(a)||Q.test(a)?g.ColumnTypeEnum.DateTime:g.ColumnTypeEnum.Text}(a);case"number":return g.ColumnTypeEnum.UnknownNumber;case"object":var b=a;if(b instanceof Array)return g.ColumnTypeEnum.Bytes;throw new R(b);default:throw new R(a)}}(e);if((void 0===c[d]||a===g.ColumnTypeEnum.Text)&&(c[d]=a),a!==g.ColumnTypeEnum.UnknownNumber)continue a}}void 0===c[d]&&(c[d]=g.ColumnTypeEnum.Int32)}return c}J(37,39),J(90,39),J(90,39),J(40,49),J(41,49),J(42,49),J(43,49),J(44,49),J(45,49),J(46,49),J(47,49);var P=new RegExp(/^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))$|^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$|^(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))$/),Q=/^\d{4}-[0-1]\d-[0-3]\d [0-2]\d:[0-5]\d:[0-5]\d$/,R=class extends Error{name="UnexpectedTypeError";constructor(a){const b=typeof a;super(`unexpected value of type ${b}: ${"object"===b?JSON.stringify(a):String(a)}`)}};function S(a,b){for(let c=0;c<a.length;c++){let d=a[c];if(d instanceof ArrayBuffer){a[c]=new Uint8Array(d);continue}if("number"==typeof d&&(b[c]===g.ColumnTypeEnum.Int32||b[c]===g.ColumnTypeEnum.Int64)&&!Number.isInteger(d)){a[c]=Math.trunc(d);continue}if("number"==typeof d&&b[c]===g.ColumnTypeEnum.Text||"bigint"==typeof d){a[c]=d.toString();continue}b[c]===g.ColumnTypeEnum.Boolean&&(a[c]=JSON.parse(d))}return a}function T(a,b){if(null===a)return null;if("bigint"==typeof a||"bigint"===b.scalarType){let b=Number.parseInt(`${a}`);if(!Number.isSafeInteger(b))throw Error(`Invalid Int64-encoded value received: ${a}`);return b}return"string"==typeof a&&"int"===b.scalarType?Number.parseInt(a):"string"==typeof a&&"float"===b.scalarType||"string"==typeof a&&"decimal"===b.scalarType?Number.parseFloat(a):!0===a?1:!1===a?0:("string"==typeof a&&"datetime"===b.scalarType&&(a=new Date(a)),a instanceof Date)?a.toISOString().replace("Z","+00:00"):"string"==typeof a&&"bytes"===b.scalarType?Array.from(Buffer.from(a,"base64")):a instanceof Uint8Array?Array.from(a):a}function U(a){if("string"==typeof a.message)return{originalMessage:a.message,...function(a){let b=a.message.split("D1_ERROR: ").at(1)??a.message;if((b=b.split("SqliteError: ").at(1)??b).startsWith("UNIQUE constraint failed")||b.startsWith("PRIMARY KEY constraint failed")){let a=b.split(": ").at(1)?.split(", ").map(a=>a.split(".").pop());return{kind:"UniqueConstraintViolation",constraint:void 0!==a?{fields:a}:void 0}}if(b.startsWith("NOT NULL constraint failed")){let a=b.split(": ").at(1)?.split(", ").map(a=>a.split(".").pop());return{kind:"NullConstraintViolation",constraint:void 0!==a?{fields:a}:void 0}}if(b.startsWith("FOREIGN KEY constraint failed")||b.startsWith("CHECK constraint failed"))return{kind:"ForeignKeyConstraintViolation",constraint:{foreignKey:{}}};if(b.startsWith("no such table"))return{kind:"TableDoesNotExist",table:b.split(": ").at(1)};if(b.startsWith("no such column"))return{kind:"ColumnNotFound",column:b.split(": ").at(1)};else if(b.includes("has no column named "))return{kind:"ColumnNotFound",column:b.split("has no column named ").at(1)};return{kind:"sqlite",extendedCode:a.code??a.cause?.code??1,message:a.message}}(a)};throw a}var V=(0,f.Debug)("prisma:driver-adapter:d1-http");function W({errors:a}){V("D1 HTTP Errors: %O",a);let b=a.at(0)??{message:"Unknown error",code:1};throw new g.DriverAdapterError(U(b))}function X(a){throw V("HTTP Error: %O",a),new g.DriverAdapterError(U(a))}function Y(a){throw console.error("Error in performIO: %O",a),new g.DriverAdapterError(U(a))}async function Z(a,b){try{let c=await a.post("raw",b).json();return V("[js::performRawQuery] %O",{success:c.success,errors:c.errors,messages:c.messages,result:c.result}),c.success||W(c),c.result}catch(a){X(a)}}var $=class{constructor(a){this.client=a}provider="sqlite";adapterName=`${G}-http`;async queryRaw(a){V("[js::query_raw] %O",a);let b=await this.performIO(a);return this.convertData(b)}convertData({columnNames:a,rows:b}){if(0===b.length)return{columnNames:[],columnTypes:[],rows:[]};let c=O(a,b),d=b.map(a=>S(a,c));return{columnNames:a,columnTypes:c,rows:d}}async executeRaw(a){return V("[js::execute_raw] %O",a),(await this.performIO(a)).affectedRows??0}async performIO(a){try{let b={json:{sql:a.sql,params:a.args.map((b,c)=>T(b,a.argTypes[c]))}};V("[js::perform_io] %O",b);let c=await Z(this.client,b);if(1!==c.length)throw Error("Expected exactly one result");let d=c[0],{columns:e=[],rows:f=[]}=d.results??{},g=d.meta?.changes;return{rows:f,columnNames:e,affectedRows:g}}catch(a){Y(a)}}},_=class extends ${constructor(a,b){super(a),this.options=b}async commit(){V("[js::commit]")}async rollback(){V("[js::rollback]")}},aa=class extends ${constructor(a,b){super(D.create({prefixUrl:`https://api.cloudflare.com/client/v4/accounts/${a.CLOUDFLARE_ACCOUNT_ID}/d1/database/${a.CLOUDFLARE_DATABASE_ID}`,headers:{Authorization:`Bearer ${a.CLOUDFLARE_D1_TOKEN}`},throwHttpErrors:!1})),this.release=b}tags={error:K("prisma:error"),warn:L("prisma:warn"),info:N("prisma:info"),query:M("prisma:query")};alreadyWarned=new Set;warnOnce=(a,b,...c)=>{this.alreadyWarned.has(a)||(this.alreadyWarned.add(a),console.info(`${this.tags.warn} ${b}`,...c))};async executeScript(a){try{await Z(this.client,{json:{sql:a}})}catch(a){Y(a)}}getConnectionInfo(){return{maxBindValues:98,supportsRelationJoins:!1}}async startTransaction(a){if(a&&"SERIALIZABLE"!==a)throw new g.DriverAdapterError({kind:"InvalidIsolationLevel",level:a});this.warnOnce("D1 Transaction","Cloudflare D1 does not support transactions yet. When using Prisma's D1 adapter, implicit & explicit transactions will be ignored and run as individual queries, which breaks the guarantees of the ACID properties of transactions. For more details see https://pris.ly/d/d1-transactions");let b={usePhantomQuery:!0};return V("%s options: %O","[js::startTransaction]",b),new _(this.client,b)}async dispose(){await this.release?.()}},ab=class{constructor(a){this.params=a}provider="sqlite";adapterName=`${G}-http`;async connect(){return new aa(this.params,async()=>{})}async connectToShadowDb(){let a=`https://api.cloudflare.com/client/v4/accounts/${this.params.CLOUDFLARE_ACCOUNT_ID}/d1/database`,b=D.create({headers:{Authorization:`Bearer ${this.params.CLOUDFLARE_D1_TOKEN}`},throwHttpErrors:!1}),c=async()=>{let c="[js::connectToShadowDb::createShadowDatabase]",d=`_prisma_shadow_${globalThis.crypto.randomUUID()}`;V(`${c} creating database %s`,d);try{let e=await b.post(a,{json:{name:d}}).json();V(`${c} %O`,e),e.success||W(e);let{uuid:f}=e.result;return V(`${c} created database %s with ID %s`,d,f),f}catch(a){X(a)}},d=this.params.CLOUDFLARE_SHADOW_DATABASE_ID??await c(),e=async()=>{let c="[js::connectToShadowDb::dispose]";try{V(`${c} deleting database %s`,d);let e=await b.delete(`${a}/${d}`).json();V(`${c} %O`,e),e.success||W(e)}catch(a){X(a)}};return new aa(this.params,e)}},ac=(0,f.Debug)("prisma:driver-adapter:d1"),ad=class{constructor(a){this.client=a}provider="sqlite";adapterName=G;async queryRaw(a){ac("[js::query_raw] %O",a);let b=await this.performIO(a);return this.convertData(b)}convertData(a){let b=a[0],c=a[1];if(0===c.length)return{columnNames:[],columnTypes:[],rows:[]};let d=Object.values(O(b,c)),e=c.map(a=>S(a,d));return{columnNames:b,columnTypes:d,rows:e}}async executeRaw(a){return ac("[js::execute_raw] %O",a),(await this.performIO(a,!0)).meta.changes??0}async performIO(a,b=!1){try{let c=a.args.map((b,c)=>T(b,a.argTypes[c])),d=this.client.prepare(a.sql).bind(...c);if(b)return await d.run();{let[a,...b]=await d.raw({columnNames:!0});return[a,b]}}catch(a){ah(a)}}},ae=class extends ad{constructor(a,b){super(a),this.options=b}async commit(){ac("[js::commit]")}async rollback(){ac("[js::rollback]")}},af=class extends ad{constructor(a,b){super(a),this.release=b}tags={error:K("prisma:error"),warn:L("prisma:warn"),info:N("prisma:info"),query:M("prisma:query")};alreadyWarned=new Set;warnOnce=(a,b,...c)=>{this.alreadyWarned.has(a)||(this.alreadyWarned.add(a),console.info(`${this.tags.warn} ${b}`,...c))};async executeScript(a){try{await this.client.exec(a)}catch(a){ah(a)}}getConnectionInfo(){return{maxBindValues:98,supportsRelationJoins:!1}}async startTransaction(a){if(a&&"SERIALIZABLE"!==a)throw new g.DriverAdapterError({kind:"InvalidIsolationLevel",level:a});this.warnOnce("D1 Transaction","Cloudflare D1 does not support transactions yet. When using Prisma's D1 adapter, implicit & explicit transactions will be ignored and run as individual queries, which breaks the guarantees of the ACID properties of transactions. For more details see https://pris.ly/d/d1-transactions");let b={usePhantomQuery:!0};return ac("%s options: %O","[js::startTransaction]",b),new ae(this.client,b)}async dispose(){await this.release?.()}},ag=class{constructor(a){this.client=a}provider="sqlite";adapterName=G;async connect(){return new af(this.client,async()=>{})}};function ah(a){throw console.error("Error in performIO: %O",a),new g.DriverAdapterError(U(a))}var ai=class{provider="sqlite";adapterName=G;connect;connectToShadowDb;constructor(a){if(function(a){return"object"==typeof a&&null!==a&&"CLOUDFLARE_D1_TOKEN"in a&&"CLOUDFLARE_ACCOUNT_ID"in a&&"CLOUDFLARE_DATABASE_ID"in a}(a)){const b=new ab(a);this.connect=b.connect.bind(b),this.connectToShadowDb=b.connectToShadowDb.bind(b)}else{const b=new ag(a);this.connect=b.connect.bind(b)}}},aj=F.default.join(".wrangler","state","v3","d1","miniflare-D1DatabaseObject");function ak(){let a=process.cwd(),b=F.default.join(a,aj);return E.default.readdirSync(b).filter(a=>a.endsWith(".sqlite")).map(a=>F.default.join(b,a))}a.s(["PrismaD1",()=>ai,"PrismaD1Http",()=>ab,"listLocalDatabases",()=>ak],3292)}];

//# sourceMappingURL=node_modules_%40prisma_adapter-d1_dist_index-node_mjs_9f581e6c._.js.map